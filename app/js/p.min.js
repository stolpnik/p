(function(a){var b,c=function(a,b){return function(){return a.apply(b,arguments)}};b=function(){function b(a,b){a==null&&(a="body"),b==null&&(b=d),this.pageMove=c(this.pageMove,this),this.data="",this.title="",this.pages=[],this.renderer=new b(a)}return b.SPLIT_STR="|||||",b.LEFT=37,b.UP=38,b.RIGHT=39,b.DOWN=40,b.IDLE=0,b.FIRED=1,b.prototype.data=null,b.prototype.title=null,b.prototype.pages=null,b.prototype.renderer=null,b.prototype.lastPage=1,b.prototype.currentPage=1,b.prototype.totalPages=0,b.prototype.keyState=b.IDLE,b.prototype.init=function(b){var c,d;return b==null&&(b="p.md"),d=this,c=a.Deferred(),a.when(this.load(b)).done(function(a){return d.addPages(d.parse(a)),d.setup(),c.resolve()}).fail(function(a){throw a}),c.promise()},b.prototype.load=function(b){var c;return b==null&&(b="p.md"),c=a.get(b),a.when(c).done(function(a){return this.data=a}).fail(function(a){throw a}),c},b.prototype.parse=function(a){var b;return b=new Showdown.converter,b.makeHtml(a)},b.prototype.addPages=function(a){var c,d,e,f,g,h,i,j,k;h=/(<h1.+"?>.+<\/h1>)/,g=a.match(h),g[0]!=null&&(this.title=g[0]),a=a.replace(h,""),e=a.match(/(<h2.+"?>.+<\/h2>)/g),a=a.replace(/(<h2.+"?>.+<\/h2>)/g,b.SPLIT_STR),d=a.split(b.SPLIT_STR),d.shift(),this.totalPages=e.length,k=[];for(c=i=0,j=e.length;i<j;c=++i)f=e[c],k.push(this.pages.push(""+f+"\n"+d[c]));return k},b.prototype.setup=function(){var c=this;return this.renderer.render(this),a(document).keydown(this.pageMove),a(document).keyup(function(a){return c.keyState=b.IDLE}),a(window).resize(this.renderer.resize)},b.prototype.show=function(a){var b;return a==null&&(a=1),this.lastPage=this.currentPage,this.currentPage=a,b=this.pages[a-1],this.renderer.showPage(a,this.lastPage),b},b.prototype.pageMove=function(a){if(this.keyState===b.FIRED)return;switch(a.keyCode){case b.RIGHT:return this.next(),this.keyState=b.FIRED;case b.LEFT:return this.prev(),this.keyState=b.FIRED;case b.UP:return this.show(1),this.keyState=b.FIRED;case b.DOWN:return this.show(this.totalPages),this.keyState=b.FIRED}},b.prototype.next=function(){var a;return a=this.currentPage===this.totalPages?1:this.currentPage+1,this.show(a)},b.prototype.prev=function(){var a;return a=this.currentPage===1?this.totalPages:this.currentPage-1,this.show(a)},b}(),this.p||(this.p={}),this.p.P=b;var d;d=function(){function b(b){this.target=a(b)}return b.prototype.render=function(b){var c,d;return this.container=a(templates.page.render({title:b.title,totalPages:b.totalPages,pages:function(){var a,e,f,g;f=b.pages,g=[];for(c=a=0,e=f.length;a<e;c=++a)d=f[c],g.push({pageNum:c+1,pageId:"page-"+(c+1),zIndex:b.totalPages-c,pageHtml:d});return g}()})),this.target.append(this.container),a("div.page",this.container).hide(),a("div#page-1",this.container).show(),a("#p").on("webkitAnimationStart","div.page",function(){}),a("#p").on("webkitAnimationEnd","div.page",function(){}),this.resize()},b.prototype.resize=function(b){var c,d;return d=a("div.page",this.container),c=a(window).height(),d.css({top:(c-d.height())*.5})},b.prototype.showPage=function(b,c){return c!=null&&a("#page-"+c).hide(),a("#page-"+b).show(),a("#current-page").text(b)},b}(),this.p||(this.p={}),this.p.S=d})(jQuery);